"use strict";(self["webpackChunkapp"]=self["webpackChunkapp"]||[]).push([[681],{6681:function(e,t,s){s.r(t),s.d(t,{default:function(){return f}});var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"main"}},[s("div",{staticClass:"title"},[e._v("X 云盘")]),s("div",{directives:[{name:"show",rawName:"v-show",value:!e.captchaShow,expression:"!captchaShow"}],staticClass:"container"},[s("div",{staticClass:"opt"},[s("div",{class:1==e.unchoosed?"unchoosed":"",on:{click:function(t){e.unchoosed=2}}},[e._v(" 登录 ")]),s("div",{class:2==e.unchoosed?"unchoosed":"",on:{click:function(t){e.unchoosed=1}}},[e._v(" 注册 ")])]),2==e.unchoosed?s("div",{staticClass:"form"},[s("form",[s("div",{staticClass:"input-box"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],staticClass:"fm-text",attrs:{type:"text",placeholder:"请输入用户名"},domProps:{value:e.username},on:{input:function(t){t.target.composing||(e.username=t.target.value)}}})]),s("div",{staticClass:"input-box"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.pw,expression:"pw"}],staticClass:"fm-text",attrs:{type:"password",placeholder:"请输入密码"},domProps:{value:e.pw},on:{input:function(t){t.target.composing||(e.pw=t.target.value)}}})]),s("div",{staticClass:"input-box"},[s("button",{on:{click:function(t){return t.preventDefault(),e.changeCaptchaShow.apply(null,arguments)}}},[e._v("登录")])]),s("div",{staticClass:"check"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.autoLogin,expression:"autoLogin"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.autoLogin)?e._i(e.autoLogin,null)>-1:e.autoLogin},on:{change:function(t){var s=e.autoLogin,a=t.target,o=!!a.checked;if(Array.isArray(s)){var i=null,r=e._i(s,i);a.checked?r<0&&(e.autoLogin=s.concat([i])):r>-1&&(e.autoLogin=s.slice(0,r).concat(s.slice(r+1)))}else e.autoLogin=o}}}),e._v("下次自动登录 ")])])]):e._e(),1==e.unchoosed?s("div",{staticClass:"form"},[s("form",[s("div",{staticClass:"input-box"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],staticClass:"fm-text",attrs:{type:"text",placeholder:"请输入用户名"},domProps:{value:e.username},on:{input:function(t){t.target.composing||(e.username=t.target.value)}}})]),s("div",{staticClass:"input-box"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.pw,expression:"pw"}],staticClass:"fm-text",attrs:{type:"password",placeholder:"请输入密码"},domProps:{value:e.pw},on:{input:function(t){t.target.composing||(e.pw=t.target.value)}}})]),s("div",{staticClass:"input-box"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.rpw,expression:"rpw"}],staticClass:"fm-text",attrs:{type:"password",placeholder:"请再次输入密码"},domProps:{value:e.rpw},on:{input:function(t){t.target.composing||(e.rpw=t.target.value)}}})]),s("div",{staticClass:"input-box"},[s("button",{on:{click:function(t){return t.preventDefault(),e.changeCaptchaShow.apply(null,arguments)}}},[e._v("注册")])])])]):e._e()]),s("captcha",{directives:[{name:"show",rawName:"v-show",value:e.captchaShow,expression:"captchaShow"}],staticClass:"captcha",attrs:{username:e.username,autoLogin:e.autoLogin,pw:e.pw,changeCaptchaShow:e.changeCaptchaShow,captchaShow:e.captchaShow,unchoosed:e.unchoosed}})],1)},o=[],i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"CaptchaContainer"},[s("div",{staticClass:"refresh",on:{click:e.getCapthcaPic}},[e._v("刷新")]),s("div",{staticClass:"close",on:{click:e.close}},[e._v("X")]),s("img",{ref:"captchaPic",attrs:{src:"",alt:""}}),s("img",{ref:"slidePic",staticClass:"slidePic",attrs:{src:"",alt:""}}),s("div",{staticClass:"bn-container"}),s("div",{ref:"coverBG",staticClass:"coverBG"}),s("div",{staticClass:"tip"},[e._v("向右滑动完成拼图")]),s("div",{ref:"slider",staticClass:"slider",on:{mousedown:function(t){return e.sliderMoveStart(t)}}},[e._v(">>>")])])},r=[],c=(s(8675),s(3462),s(2801),s(3228)),n={name:"captcha",props:["username","pw","autoLogin","changeCaptchaShow","captchaShow","unchoosed"],data(){return{MouseStartPos:0,MoveFlag:!1,MouseRoute:[]}},beforeDestroy(){console.log("cap destroy"),document.onmousemove=null,document.onmouseup=null},methods:{close(){this.$bus.$emit("closeCaptcha")},sliderMoveStart(e){this.MouseStartPos=e.clientX,this.MoveFlag=!0},sliderMove(e){this.MoveFlag&&(this.MouseRoute.push([e.clientX,e.clientY]),e.clientX-this.MouseStartPos>=0&&e.clientX-this.MouseStartPos<=250?(this.$refs.slidePic.style.left=e.clientX-this.MouseStartPos+"px",this.$refs.slider.style.left=e.clientX-this.MouseStartPos+"px",this.$refs.coverBG.style.width=e.clientX-this.MouseStartPos+"px"):e.clientX-this.MouseStartPos<0?(this.$refs.slidePic.style.left=0,this.$refs.slider.style.left=0,this.$refs.coverBG.style.width=0):(this.$refs.slidePic.style.left="250px",this.$refs.slider.style.left="250px",this.$refs.coverBG.style.width="250px"))},async sliderMoveEnd(e){console.log(this.unchoosed),this.MoveFlag&&(this.MoveFlag=!1,2==this.unchoosed?this.login():this.register())},async login(){console.log("logining..");var e=new URLSearchParams;e.append("username",this.username),e.append("password",this.pw),e.append("mouseroute",this.MouseRoute.toString()),e.append("sliderPos",this.$refs.slider.style.left);try{await this.$store.dispatch("login",{params:e,autoLogin:this.autoLogin}),this.$refs.coverBG.style.backgroundColor="green",setTimeout((()=>{alert("登录成功"),this.$router.push("/home/folder")}),100)}catch(t){this.$refs.coverBG.style.backgroundColor="red","CaptchaError"==t.message?setTimeout((()=>{this.$refs.slidePic.style.left=0,this.$refs.slider.style.left=0,this.$refs.coverBG.style.width=0,this.$refs.coverBG.style.backgroundColor="rgba(99, 125, 255, 1)",this.getCapthcaPic()}),200):setTimeout((()=>{alert(t.message),this.close()}),100)}},async register(){var e=new URLSearchParams;e.append("username",this.username),e.append("password",this.pw),e.append("mouseroute",this.MouseRoute),e.append("sliderPos",this.$refs.slider.style.left);try{await this.$store.dispatch("register",e);this.$refs.coverBG.style.backgroundColor="green",setTimeout((()=>{alert("注册成功"),this.$bus.$emit("resetunchoosed"),this.close()}),200)}catch(t){this.$refs.coverBG.style.backgroundColor="red","CaptchaError"==t.message?setTimeout((()=>{this.$refs.slidePic.style.left=0,this.$refs.slider.style.left=0,this.$refs.coverBG.style.width=0,this.$refs.coverBG.style.backgroundColor="rgba(99, 125, 255, 1)",this.getCapthcaPic()}),200):setTimeout((()=>{alert(t.message),this.close()}),100)}},async getCapthcaPic(){let e=await(0,c.cC)();console.log(e),console.log(e.captchaPic),console.log(typeof e.captchaPic);let t=new Uint8Array(e.captchaPic.data),s="",a=t.byteLength;for(let o=0;o<a;o++)s+=String.fromCharCode(t[o]);this.$refs.captchaPic.src="data:image/png;base64,"+window.btoa(s),t=new Uint8Array(e.sliderPic.data),s="",a=t.byteLength;for(let o=0;o<a;o++)s+=String.fromCharCode(t[o]);this.$refs.slidePic.src="data:image/png;base64,"+window.btoa(s),this.$refs.slidePic.style.top=e.posY+"px"}},watch:{captchaShow(e){e&&(this.$refs.slidePic.style.left=0,this.$refs.slider.style.left=0,this.$refs.coverBG.style.width=0,this.$refs.coverBG.style.backgroundColor="rgba(99, 125, 255, 1)",document.onmousemove=this.sliderMove,document.onmouseup=this.sliderMoveEnd,this.getCapthcaPic()),e||(document.onmousemove=null,document.onmouseup=null)}}},l=n,h=s(1001),u=(0,h.Z)(l,i,r,!1,null,"6d6a7707",null),p=u.exports,d={name:"login",components:{captcha:p},mounted(){this.$bus.$on("closeCaptcha",(()=>{this.captchaShow=!this.captchaShow})),this.$bus.$on("resetunchoosed",(()=>{this.unchoosed=2}))},data(){return{unchoosed:2,autoLogin:!0,username:"",pw:"",rpw:"",captchaShow:!1}},watch:{unchoosed:{handler(){this.username="",this.pw="",this.rpw=""}}},methods:{changeCaptchaShow(){if(2==this.unchoosed){if(""==this.username||""==this.pw)return void alert("用户名或密码不能为空")}else{if(""==this.username||""==this.pw||""==this.rpw)return void alert("用户名或密码不能为空");if(this.pw!=this.rpw)return alert("两次密码输入不同"),this.pw="",void(this.rpw="")}this.captchaShow=!this.captchaShow}}},m=d,v=(0,h.Z)(m,a,o,!1,null,null,null),f=v.exports}}]);